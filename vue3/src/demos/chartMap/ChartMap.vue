<!-- @format -->
<template>
  <a-page-header>
    <template #title>
      <a-breadcrumb>
        <a-breadcrumb-item>DEMO</a-breadcrumb-item>
        <a-breadcrumb-item>ECHARTS 地图</a-breadcrumb-item>
      </a-breadcrumb>
    </template>
    <section class="content">
      <a-row :gutter="[12, 12]">
        <a-col :span="8">
          <a-card class="card" title="地图 - 普通">
            <a-radio-group v-model:value="selectedCity">
              <a-radio-button v-for="item in [
                { label: '杭州', value: 'hangZhou' },
                { label: '绍兴', value: 'shaoXing' },
              ]" :key="item.value" :value="item.value">
                {{ item.label }}
              </a-radio-button>
            </a-radio-group>

            {{ selectedCity }}
            <VChart v-if="isRegistered" :style="{ width: '100%', height: '400px' }"
              :option="computedChartsMapDefaultOption" :ref="(ref) => (chartsBarCarouselHighLightRef = ref)" autoSize />
          </a-card>
        </a-col>
      </a-row>
    </section>
  </a-page-header>
</template>
<script lang="jsx" setup>
import { set, tryOnMounted } from '@vueuse/core';
import * as echarts from 'echarts';
import { provide, ref, computed } from 'vue';
import VChart, { THEME_KEY } from 'vue-echarts';
// apis
// hooks
// utils
// types
// stores
// mixins
// configs
// components
provide(THEME_KEY, 'dark');
const chartsBarCarouselHighLightRef = ref();
const isRegistered = ref(false);

const selectedCity = ref('hangZhou');

const getGeojson = async () => {
  try {
    const geojsonShaoXing = await fetch('/assets/geojson/浙江省/绍兴市.json').then((res) => res.json());
    const geojsonHangZhou = await fetch('/assets/geojson/浙江省/杭州市.json').then((res) => res.json());
    echarts.registerMap('shaoXing', geojsonShaoXing);
    echarts.registerMap('hangZhou', geojsonHangZhou);

    set(isRegistered, true);
  } catch (error) {
    console.warn(error);
  }
};

const computedChartsMapDefaultOption = computed(() => {
  try {
    const grid = {
      show: false,
      left: 20,
      right: 20,
      top: 40,
      bottom: 20,
      containLabel: true,
      backgroundColor: 'rgba(0,0,0,0)',
      borderWidth: 1,
      borderColor: '#ccc',
    };

    let serieMap = {};
    let serieLine = {};

    switch (selectedCity.value) {
      case 'shaoXing':
        serieMap = {
          name: 'shaoXing',
          type: 'map',
          map: 'shaoXing',
          label: { show: true },
          nameProperty: 'name',
          itemStyle: { label: { show: true, color: '#fff' }, color: '#fff', borderWidth: 1, borderColor: '#32CBE0' },
          select: { label: { show: false, color: '#fff' } },
          emphasis: { disabled: true },
          tooltip: { show: false, trigger: 'item' },
        };
        serieLine = {
          type: 'lines',
          coordinateSystem: 'geo',
          data: [
            {
              coords: [
                [120.14322240845, 30.236064370321],
                [120.14280555506, 30.23633761213],
                [120.14307598649, 30.236125905084],
                [120.14301682797, 30.236035316745],
                [120.1428734612, 30.236160551632],
                [120.14200215328, 30.23595702204],
                [120.14138577045, 30.236113748704],
                [120.1400398833, 30.235973050702],
                [120.13893453465, 30.23517220446],
                [120.1382899739, 30.234062922977],
                [120.13634057665, 30.233446752432],
                [120.13413680453, 30.232112168844],
                [120.13333353311, 30.232145779364],
                [120.13306479103, 30.231759284837],
                [120.13265960629, 30.231641351722],
                [120.1327455782, 30.231430284343],
                [120.13218153673, 30.230180120187],
                [120.13170681763, 30.229925745619],
                [120.13140700148, 30.229576173509],
                [120.13119614803, 30.228996846637],
                [120.13066649155, 30.228846445356],
                [120.13023980134, 30.228226570416],
                [120.12989250643, 30.228177899345],
                [120.1297674531, 30.227895075522],
                [120.12941575407, 30.228596968401],
                [120.12900512996, 30.228293967376],
                [120.12920653848, 30.228281493076],
                [120.12914997592, 30.22811126636],
                [120.12887629039, 30.227990425169],
                [120.12797286481, 30.228127070174],
                [120.12749160626, 30.228348006385],
                [120.12728472245, 30.228132519108],
                [120.12725816563, 30.227718527678],
                [120.12699742758, 30.227225482569],
                [120.12705029341, 30.226639976046],
                [120.12620458002, 30.225849596694],
                [120.12629723613, 30.225609780737],
                [120.12611630111, 30.225592655172],
                [120.12623751461, 30.225514547091],
                [120.12569412003, 30.225289138515],
                [120.1260081246, 30.225109979145],
                [120.12428900347, 30.224907917069],
                [120.1233608862, 30.224531990576],
                [120.12328968155, 30.225342953599],
                [120.12289821299, 30.22630750923],
                [120.1226090834, 30.226410111043],
                [120.12245512244, 30.226878337044],
                [120.1221672377, 30.227216311881],
                [120.12164622224, 30.227314672485],
                [120.12131843541, 30.2278850071],
                [120.12014167505, 30.227860326084],
                [120.11982765304, 30.227656247151],
                [120.11973240019, 30.227795357688],
                [120.11925363536, 30.227845331234],
                [120.11885762159, 30.227618695459],
                [120.11832083554, 30.227828718428],
                [120.11764254714, 30.2275760858],
                [120.11660933416, 30.227423442401],
                [120.11656948113, 30.227779565953],
                [120.11622329162, 30.228135226062],
                [120.11555815443, 30.228552151927],
                [120.11535925104, 30.228933739657],
                [120.11508923593, 30.228929830582],
                [120.1146001061, 30.22934780379],
                [120.11445996865, 30.229331065139],
                [120.11431067403, 30.22978764355],
                [120.11302670426, 30.23089800754],
                [120.11221369625, 30.230690045417],
                [120.11084513509, 30.230688382099],
                [120.11075387695, 30.231230018241],
                [120.11047529772, 30.231392448881],
                [120.11044468237, 30.231294617088],
                [120.11025496346, 30.231342673512],
                [120.11030754358, 30.231163266196],
                [120.1100134074, 30.231086634903],
                [120.10942045927, 30.231514831682],
                [120.10871903343, 30.231333695816],
                [120.10807570214, 30.231423668372],
                [120.10763082528, 30.231618832285],
                [120.1076172214, 30.231857645696],
                [120.10689398326, 30.232254414884],
                [120.10654498471, 30.232314939116],
                [120.10625143658, 30.23209170759],
                [120.10561817759, 30.232356818249],
                [120.1052679884, 30.232200325878],
                [120.10469210597, 30.232873117082],
                [120.10389149564, 30.23276397585],
                [120.10356823004, 30.233116970493],
                [120.10317755244, 30.232897606201],
                [120.10252540126, 30.232913879755],
                [120.10279292553, 30.233485195807],
                [120.10276069499, 30.233702758115],
                [120.10215452954, 30.233790321439],
                [120.1009310109, 30.234705361223],
                [120.10070707153, 30.235535810923],
                [120.10094839226, 30.236688233814],
                [120.10068527845, 30.237148154301],
                [120.0991389033, 30.237324990834],
                [120.09909068745, 30.237447538545],
                [120.09889701846, 30.237349749781],
                [120.09909203766, 30.237447835223],
                [120.09885018257, 30.23750460963],
                [120.0985803733, 30.237399683068],
                [120.09846495357, 30.237544566136],
                [120.09691421859, 30.237265892435],
                [120.09640608591, 30.237517005461],
                [120.09592462988, 30.237417530439],
                [120.09578540325, 30.237505515712],
                [120.09585978634, 30.237657781556],
                [120.09513916535, 30.237598831505],
                [120.09537128694, 30.237827879177],
                [120.09463588238, 30.237553240794],
                [120.09434036469, 30.237675194088],
                [120.09435981434, 30.237393110666],
                [120.09416203126, 30.237518267502],
                [120.09442420859, 30.237544095207],
                [120.09406873401, 30.237645935348],
                [120.09421500188, 30.23757678504],
                [120.09417631939, 30.237788505192],
                [120.09401715446, 30.23763248493],
                [120.09346056016, 30.237763679213],
                [120.0931873532, 30.237498100783],
                [120.09307923181, 30.237657251],
                [120.09326434256, 30.237542950418],
                [120.09322848324, 30.2373027005],
                [120.09301091533, 30.237355077676],
                [120.09300231512, 30.237102585171],
                [120.09273277667, 30.237014001726],
                [120.09235667235, 30.237023849668],
                [120.09247034134, 30.237020799186],
                [120.09235415838, 30.236931281436],
                [120.09249523307, 30.237077424673],
                [120.09227857692, 30.236953488801],
                [120.09236889214, 30.236802403617],
                [120.09228327523, 30.236774501485],
                [120.0915479786, 30.237013030973],
                [120.09170832511, 30.236965232782],
                [120.09165932082, 30.236819989034],
                [120.09141982762, 30.236834325375],
                [120.09105978327, 30.237018774407],
                [120.09122130957, 30.236776979775],
                [120.09096738259, 30.23666355983],
                [120.09029968116, 30.236770616438],
                [120.08983820472, 30.237106950056],
                [120.08945597294, 30.23699652666],
                [120.0876611843, 30.237218331451],
                [120.08669674356, 30.236824529725],
                [120.08610557234, 30.237036276042],
                [120.08564989625, 30.237442457947],
                [120.08522299762, 30.237438959045],
                [120.08367382005, 30.23833648123],
                [120.0831192649, 30.238661839459],
                [120.0824703985, 30.239346940464],
                [120.08197389214, 30.240261233378],
                [120.08096505691, 30.241227033723],
                [120.08102040217, 30.241688743963],
                [120.08082296488, 30.241902986785],
                [120.08094825523, 30.242275513241],
                [120.08055098063, 30.242746889455],
                [120.08091800677, 30.243117337651],
                [120.08066541644, 30.243874915017],
                [120.08097997896, 30.243973922986],
                [120.08140628623, 30.244707229452],
                [120.0814422118, 30.245739043448],
                [120.08126715383, 30.245873750445],
                [120.08123670606, 30.246507455249],
                [120.08078182352, 30.247203760082],
                [120.0804165564, 30.247246611479],
                [120.07996844736, 30.248026574444],
                [120.07981347111, 30.24801058254],
                [120.07959467322, 30.248271691651],
                [120.07951968485, 30.248199710779],
                [120.0790985882, 30.248757529539],
                [120.07811028657, 30.249422684983],
                [120.07785098815, 30.249844292932],
                [120.07712986833, 30.250333460636],
                [120.07691931922, 30.250306700182],
                [120.0766375082, 30.250747346303],
                [120.07647587119, 30.250670392312],
                [120.07617433084, 30.251169573892],
                [120.07582942492, 30.251353436392],
                [120.07586188887, 30.251615828299],
                [120.07556771854, 30.251948094016],
                [120.07632605996, 30.252467111065],
              ],
            },
          ],
          polyline: true,
          lineStyle: {
            color: 'purple',
            opacity: 0.6,
            width: 100000,
          },
        };
        break;
      case 'hangZhou':
      default:
        serieMap = {
          name: 'hangZhou',
          type: 'map',
          map: 'hangZhou',
          label: { show: true },
          nameProperty: 'name',
          itemStyle: { label: { show: true, color: '#fff' }, color: '#fff', borderWidth: 1, borderColor: '#32CBE0' },
          select: { label: { show: false, color: '#fff' } },
          emphasis: { disabled: true },
          tooltip: { show: false, trigger: 'item' },
        };
        serieLine = {
          type: 'lines',
          coordinateSystem: 'geo',
          data: [
            {
              coords: [
                [120.14322240845, 30.236064370321],
                [120.14280555506, 30.23633761213],
                [120.14307598649, 30.236125905084],
                [120.14301682797, 30.236035316745],
                [120.1428734612, 30.236160551632],
                [120.14200215328, 30.23595702204],
                [120.14138577045, 30.236113748704],
                [120.1400398833, 30.235973050702],
                [120.13893453465, 30.23517220446],
                [120.1382899739, 30.234062922977],
                [120.13634057665, 30.233446752432],
                [120.13413680453, 30.232112168844],
                [120.13333353311, 30.232145779364],
                [120.13306479103, 30.231759284837],
                [120.13265960629, 30.231641351722],
                [120.1327455782, 30.231430284343],
                [120.13218153673, 30.230180120187],
                [120.13170681763, 30.229925745619],
                [120.13140700148, 30.229576173509],
                [120.13119614803, 30.228996846637],
                [120.13066649155, 30.228846445356],
                [120.13023980134, 30.228226570416],
                [120.12989250643, 30.228177899345],
                [120.1297674531, 30.227895075522],
                [120.12941575407, 30.228596968401],
                [120.12900512996, 30.228293967376],
                [120.12920653848, 30.228281493076],
                [120.12914997592, 30.22811126636],
                [120.12887629039, 30.227990425169],
                [120.12797286481, 30.228127070174],
                [120.12749160626, 30.228348006385],
                [120.12728472245, 30.228132519108],
                [120.12725816563, 30.227718527678],
                [120.12699742758, 30.227225482569],
                [120.12705029341, 30.226639976046],
                [120.12620458002, 30.225849596694],
                [120.12629723613, 30.225609780737],
                [120.12611630111, 30.225592655172],
                [120.12623751461, 30.225514547091],
                [120.12569412003, 30.225289138515],
                [120.1260081246, 30.225109979145],
                [120.12428900347, 30.224907917069],
                [120.1233608862, 30.224531990576],
                [120.12328968155, 30.225342953599],
                [120.12289821299, 30.22630750923],
                [120.1226090834, 30.226410111043],
                [120.12245512244, 30.226878337044],
                [120.1221672377, 30.227216311881],
                [120.12164622224, 30.227314672485],
                [120.12131843541, 30.2278850071],
                [120.12014167505, 30.227860326084],
                [120.11982765304, 30.227656247151],
                [120.11973240019, 30.227795357688],
                [120.11925363536, 30.227845331234],
                [120.11885762159, 30.227618695459],
                [120.11832083554, 30.227828718428],
                [120.11764254714, 30.2275760858],
                [120.11660933416, 30.227423442401],
                [120.11656948113, 30.227779565953],
                [120.11622329162, 30.228135226062],
                [120.11555815443, 30.228552151927],
                [120.11535925104, 30.228933739657],
                [120.11508923593, 30.228929830582],
                [120.1146001061, 30.22934780379],
                [120.11445996865, 30.229331065139],
                [120.11431067403, 30.22978764355],
                [120.11302670426, 30.23089800754],
                [120.11221369625, 30.230690045417],
                [120.11084513509, 30.230688382099],
                [120.11075387695, 30.231230018241],
                [120.11047529772, 30.231392448881],
                [120.11044468237, 30.231294617088],
                [120.11025496346, 30.231342673512],
                [120.11030754358, 30.231163266196],
                [120.1100134074, 30.231086634903],
                [120.10942045927, 30.231514831682],
                [120.10871903343, 30.231333695816],
                [120.10807570214, 30.231423668372],
                [120.10763082528, 30.231618832285],
                [120.1076172214, 30.231857645696],
                [120.10689398326, 30.232254414884],
                [120.10654498471, 30.232314939116],
                [120.10625143658, 30.23209170759],
                [120.10561817759, 30.232356818249],
                [120.1052679884, 30.232200325878],
                [120.10469210597, 30.232873117082],
                [120.10389149564, 30.23276397585],
                [120.10356823004, 30.233116970493],
                [120.10317755244, 30.232897606201],
                [120.10252540126, 30.232913879755],
                [120.10279292553, 30.233485195807],
                [120.10276069499, 30.233702758115],
                [120.10215452954, 30.233790321439],
                [120.1009310109, 30.234705361223],
                [120.10070707153, 30.235535810923],
                [120.10094839226, 30.236688233814],
                [120.10068527845, 30.237148154301],
                [120.0991389033, 30.237324990834],
                [120.09909068745, 30.237447538545],
                [120.09889701846, 30.237349749781],
                [120.09909203766, 30.237447835223],
                [120.09885018257, 30.23750460963],
                [120.0985803733, 30.237399683068],
                [120.09846495357, 30.237544566136],
                [120.09691421859, 30.237265892435],
                [120.09640608591, 30.237517005461],
                [120.09592462988, 30.237417530439],
                [120.09578540325, 30.237505515712],
                [120.09585978634, 30.237657781556],
                [120.09513916535, 30.237598831505],
                [120.09537128694, 30.237827879177],
                [120.09463588238, 30.237553240794],
                [120.09434036469, 30.237675194088],
                [120.09435981434, 30.237393110666],
                [120.09416203126, 30.237518267502],
                [120.09442420859, 30.237544095207],
                [120.09406873401, 30.237645935348],
                [120.09421500188, 30.23757678504],
                [120.09417631939, 30.237788505192],
                [120.09401715446, 30.23763248493],
                [120.09346056016, 30.237763679213],
                [120.0931873532, 30.237498100783],
                [120.09307923181, 30.237657251],
                [120.09326434256, 30.237542950418],
                [120.09322848324, 30.2373027005],
                [120.09301091533, 30.237355077676],
                [120.09300231512, 30.237102585171],
                [120.09273277667, 30.237014001726],
                [120.09235667235, 30.237023849668],
                [120.09247034134, 30.237020799186],
                [120.09235415838, 30.236931281436],
                [120.09249523307, 30.237077424673],
                [120.09227857692, 30.236953488801],
                [120.09236889214, 30.236802403617],
                [120.09228327523, 30.236774501485],
                [120.0915479786, 30.237013030973],
                [120.09170832511, 30.236965232782],
                [120.09165932082, 30.236819989034],
                [120.09141982762, 30.236834325375],
                [120.09105978327, 30.237018774407],
                [120.09122130957, 30.236776979775],
                [120.09096738259, 30.23666355983],
                [120.09029968116, 30.236770616438],
                [120.08983820472, 30.237106950056],
                [120.08945597294, 30.23699652666],
                [120.0876611843, 30.237218331451],
                [120.08669674356, 30.236824529725],
                [120.08610557234, 30.237036276042],
                [120.08564989625, 30.237442457947],
                [120.08522299762, 30.237438959045],
                [120.08367382005, 30.23833648123],
                [120.0831192649, 30.238661839459],
                [120.0824703985, 30.239346940464],
                [120.08197389214, 30.240261233378],
                [120.08096505691, 30.241227033723],
                [120.08102040217, 30.241688743963],
                [120.08082296488, 30.241902986785],
                [120.08094825523, 30.242275513241],
                [120.08055098063, 30.242746889455],
                [120.08091800677, 30.243117337651],
                [120.08066541644, 30.243874915017],
                [120.08097997896, 30.243973922986],
                [120.08140628623, 30.244707229452],
                [120.0814422118, 30.245739043448],
                [120.08126715383, 30.245873750445],
                [120.08123670606, 30.246507455249],
                [120.08078182352, 30.247203760082],
                [120.0804165564, 30.247246611479],
                [120.07996844736, 30.248026574444],
                [120.07981347111, 30.24801058254],
                [120.07959467322, 30.248271691651],
                [120.07951968485, 30.248199710779],
                [120.0790985882, 30.248757529539],
                [120.07811028657, 30.249422684983],
                [120.07785098815, 30.249844292932],
                [120.07712986833, 30.250333460636],
                [120.07691931922, 30.250306700182],
                [120.0766375082, 30.250747346303],
                [120.07647587119, 30.250670392312],
                [120.07617433084, 30.251169573892],
                [120.07582942492, 30.251353436392],
                [120.07586188887, 30.251615828299],
                [120.07556771854, 30.251948094016],
                [120.07632605996, 30.252467111065],
              ],
            },
          ],
          polyline: true,
          lineStyle: {
            color: 'purple',
            opacity: 0.6,
            width: 100000,
          },
        };
        break;
    }
    return {
      grid,
      backgroundColor: 'transparent',
      textStyle: { color: '#B9B8CE', fontSize: 12 },
      series: [serieMap, serieLine],
    };
  } catch (error) {
    console.warn(error);
    return { backgroundColor: 'transparent' };
  }
});

tryOnMounted(() => {
  getGeojson();
});
</script>
<style lang="less" scoped>
@import './ChartMap.less';
</style>
